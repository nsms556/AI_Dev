# [Week9 - Day4] Deep Learning 12 - CNN

## 1. Convolution Neural Netowrk (CNN, 합성 곱 신경망)
  - 컴퓨터 비전 (영상 인식) 어려운점
    - 관점의 변화 - 동일한 객체라도 카메라의 이동에 따라 모든 픽셀값이 변화
    - 보호색으로 배경과 객체의 구분이 어려움
    - 조명에 따른 변화
    - 기형적인 형태의 영상
    - 일부가 가려진 영상
    - 같은 종류 안에서도 변화가 큼
  - 구조
    - 컨볼루션 층 (CONV)
      - 컨볼루션(선형)과 활성함수(비선형)의 조합
    - 풀링 층 (POOL)
      - 컨볼루션으로 얻어진 특징을 통계적으로 압축
    - 전체 구조
      - CONV - POOL - CONV - POOL - ... - CONV - POOL - FC
  - DMLP 비교
    - DMLP
      - 완전 연결 구조 -> 높은 복잡도
      - 학습이 매우 느림, 과잉적합 우려
    - CNN
      - 컨볼루션 연산을 이용한 부분 연결 -> 낮은 복잡도
  - 특징
    - 격자구조를 갖는 데이터(영상, 음성 등)에 적합
    - 수용장은 인간시각과 유사
    - 가변 크기의 입력 처리 가능
  - 완전 연결 신경망과의 차별점
    - 학습에 의해 결정된 복수의 커널들에 대응되는 특징들을 추출 -> CONV
      - 각 층의 입출력의 특징형상 유지
      - 인접한 정보의 특징을 효과적으로 인식
      - 각 커널은 파라미터를 공유 -> 완전 연결 대비 학습 파라미터가 적음
    - 추출된 영상의 특징을 요약, 강화 -> POOL
    - 가변 크기의 데이터 다루기
      - 완전 연결은 특징 벡터의 크기가 다르면 연산 불가능
      - CNN은 가변 크기를 다룰 수 있음
        - 컨볼루션 보폭의 조정, 풀링 커널의 크기나 보폭을 조정하여 특징 맵 크기 조절

### 1-1 컨볼루션 층
  - Convolution (합성 곱) 연산
    - 해당하는 요소끼리 곱하여 결과를 모두 더하는 선형 연산
    - 영상에서 특징을 추출하기 위한 용도
    - *s* = *z* ⓧ *u* (*s* : 출력(특징 맵), *z* : 입력, *u* : 커널(필터))
   Padding
    - 가장자리에서 영상의 크기가 줄어드는 효과 방지 -> 입출력의 형상 유지
    - Zero Padding
    - Copy Padding
  - Bias 추가
    - 선형 모델의 편향
  - 가중치 공유
    - 모든 노드가 동일한 커널을 사용
    - 모델의 복잡도가 크게 낮아짐
  - 다중 특징 맵 추출
    - 커널 값에 따라 추출하는 특징이 달라짐
    - 하나의 커널만 사용시 너무 빈약한 특징만 추출
    - 실제로는 수십~수백개의 커널 사용
  - 특징 학습
    - 커널을 직접 설계하지 않고 학습을 통해 탐색
    - DMLP와 동일하게 오류 역전파를 통해 커널을 학습
  - 특징
    - 이동에 동변 (신호가 이동 -> 이동 정보가 그대로 특징 맵에 반영)
      - 영상인식-물체이동, 음성인식-발음지연 에 효과적인 대처
    - 병렬분산 구조
      - 각 노드는 독립적으로 계산 가능
      - 노드는 깊은 층을 거치면서 전체에 영향을 미치므로 분산 구조
  - 다운샘플링 (Down Sampling)
    - 모든 화소에 커널 적용 -> 보폭이 1
    - 보폭이 k이면 2차원 영상 기준 특징 맵이 1/k<sup>2</sup>로 축소
  - 텐서 적용
    - 3차원 이상의 구조에도 적용 가능

### 1-2 풀링 층
  - Pooling 연산
    - 최대 풀링, 평균 풀링, 가중치 풀링
    - 보폭이 크면 다운샘플링 효과
  - 특성
    - 상세 내용의 요약, 통계적 대표성을 추출
    - 파라미터 없음
    - 특징 맵의 수를 그대로 유지 (크기 유지가 아님)
    - 연산 효윯화
    - 작은 변화에 둔감 -> 영상 인식, 검색에 효과적

### 1-3 전체 구조
  - 빌딩 블록
    - 빌딩 블록을 이어 붙여 깊은 구조로 확장
    - 다중 커널을 사용 -> 다중 특징 맵 추출
  - 컨볼루션 층의 출력 크기, 파라미터 수
    - 입력 : W<sub>1</sub> * D<sub>1</sub> * H<sub>1</sub>, 커널 : F*F K개, 보폭 : S, 패딩 : P
    - 출력 : W<sub>2</sub> * D<sub>2</sub> * H<sub>2</sub>
      - W<sub>2</sub> = (W<sub>1</sub> - F + 2P) / (S + 1)
      - H<sub>2</sub> = (H<sub>1</sub> - F + 2P) / (S + 1)
      - D<sub>2</sub> = K
    - 파라미터
      - 커널마다 (F * F * D<sub>1</sub>)개의 가중치, 1개의 바이어스
      - 전체 : K * (F * F * D<sub>1</sub> + 1)
    - 일반적으로 F=2, S=2 or F=3, S=1
  - LeNet-5 (초창기 CNN 중 하나)
    - CONV - POOL - CONV - POOL - CONV의 5층 구조
    - 28 * 28 명암 영상을 120차원의 특징 벡터로 변환
      - 평균 풀링
    - 은닉층이 하나인 MLP
    - 필기 숫자 인식기 -> 수표 인식 자동화 시스템 구현 -> CNN의 첫번째 성공 사례